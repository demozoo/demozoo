{% load demoscene_tags ui_tags %}

<div class="panel editable_chunk">
    <h3 class="panel__title productions_header">Productions ({{ credits|length }})</h3>
    {% if can_edit %}
        <div class="o-actions">
            {% button href=new_production_url icon="add" lightbox=True label="Add production" %}
        </div>
    {% endif %}

    <table class="table">
        <colgroup>
            <col class="col--thumb" />
            <col width="40%" />
            <col />
            <col class="col--date" />
            {% if editing and site_is_writeable %}
                <col />
            {% endif %}
        </colgroup>
        <tbody>
            {% for production, nick, credits, screenshot in credits %}
                <tr>
                    <td>
                        {% if screenshot %}
                            {% microthumb screenshot %}

                        {% else %}
                            <div class="media media--thumbnail">
                                {% icon production.supertype %}
                            </div>
                        {% endif %}
                    </td>
                    <td>
                        <div>
                            <a href="{{ production.get_absolute_url }}">{{ production.title }}</a>
                            {% if credits %}
                                -
                                {% for credit in credits %}
                                    <span>{{ credit.description }}</span>{% if not forloop.last %},{% endif %}
                                {% endfor %}
                                {% if nick.name != releaser.name %}
                                    <em>(as <span>{{ nick.name }}</span>)</em>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="meta">
                            {{ production.platforms_and_types_list }}
                        </div>
                    </td>
                    <td>{% byline production %}</td>
                    <td>{{ production.release_date.short_format }}</td>

                    {% if editing and site_is_writeable %}
                        <td>
                            {% url 'releaser_edit_credit' nick.releaser_id nick.id production.id as releaser_edit_credit_url %}
                            {% button href=releaser_edit_credit_url level="tertiary" lightbox=True title="Edit credit" %}
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
