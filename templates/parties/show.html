{% extends "base.html" %}
{% load demoscene_tags %}
{% load safe_markdown %}

{% block html_title %}{{ party.name }} - Demozoo{% endblock %}

{% block base_main %}
	<div class="panel">
		<div class="party_details">
			<h2>
				{{ party.name }}{% if party.tagline %}: <span class="tagline">"{{ party.tagline }}"</span>{% endif %}
				<a href="{% url edit_party party.id %}" class="open_in_lightbox"><img src="/static/images/icons/edit.png" width="16" height="16" alt="Edit party" title="Edit party" /></a>
			</h2>
			{% date_range party.start_date party.end_date %}
			
			{% if party.party_series.website %}
				<p><a href="{{ party.party_series.website }}">{{ party.party_series.website }}</a></p>
			{% endif %}
			
			<p>
				Location:
				{% if party.location %}
					{{ party.location }}
					{% if party.country_code %}
						<img src="/static/images/icons/flags/{{ party.country_code|lower }}.png" alt="" />
					{% endif %}
				{% else %}
					<em>Not set</em>
				{% endif %}
			</p>
			
			<div class="external_links">
				<h3>External links:</h3>
				<ul>
					{% if party.homepage %}<li><a href="{{ party.homepage }}" class="homepage" title="{{ party.name }} homepage">WWW</a></li>{% endif %}
					{% if party.twitter_url %}<li><a href="{{ party.twitter_url }}" class="twitter" title="{{ party.name }} on Twitter">Twitter</a></li>{% endif %}
					{% if party.demoparty_net_url %}<li><a href="{{ party.demoparty_net_url }}" class="demoparty_net" title="{{ party.name }} on demoparty.net">demoparty.net</a></li>{% endif %}
					{% if party.slengpung_url %}<li><a href="{{ party.slengpung_user_url }}" class="slengpung" title="{{ party.name }} on Slengpung">Slengpung</a></li>{% endif %}
					{% if party.pouet_url %}<li><a href="{{ party.pouet_url }}" class="pouet" title="{{ party.name }} on Pouët">Pouët</a></li>{% endif %}
					{% if party.bitworld_url %}<li><a href="{{ party.bitworld_url }}" class="bitworld" title="{{ party.name }} on BitWorld">BitWorld</a></li>{% endif %}
					{% if party.csdb_url %}<li><a href="{{ party.csdb_url }}" class="csdb" title="{{ party.name }} on CSDb">CSDb</a></li>{% endif %}
					{% if party.breaks_amiga_url %}<li><a href="{{ party.breaks_amiga_url }}" class="breaks_amiga" title="{{ party.name }} on Break's Amiga Collection">Break's Amiga Collection</a></li>{% endif %}
					{% if party.zxdemo_url %}<li><a href="{{ party.zxdemo_url }}" class="zxdemo" title="{{ party.name }} on zxdemo.org">ZXdemo</a></li>{% endif %}
					{% if party.scene_org_url %}<li><a href="{{ party.scene_org_url }}" class="sceneorg" title="{{ scener.name }} on scene.org">scene.org</a></li>{% endif %}
					<li><a href="{% url party_edit_external_links party.id %}" class="edit open_in_lightbox">Edit</a></li>
				</ul>
			</div>
			
			{% with party.party_series.parties.all as parties_in_series %}
				{% if parties_in_series.count > 1 %}
					<div>
						Other <a href="{{ party.party_series.get_absolute_url }}">{{ party.party_series.name }}</a> parties:
						<ul class="parties_in_series">
							{% for party_in_series in parties_in_series %}
								{% if party_in_series == party %}
									<li class="current">{{ party_in_series.suffix }}</li>
								{% else %}
									<li>
										<a href="{{ party_in_series.get_absolute_url }}">{{ party_in_series.suffix }}</a>
									</li>
								{% endif %}
							{% endfor %}
						</ul>
					</div>
				{% endif %}
			{% endwith %}
		</div>
	</div>
	
	{% if party.notes or request.user.is_staff %}
		<div class="notes">
			{% if request.user.is_staff %}
				<ul class="actions">
					<li><a class="edit open_in_lightbox" href="{% url party_edit_notes party.id %}">Edit notes</a></li>
				</ul>
			{% endif %}
			{{ party.notes|safe_markdown }}
			<div style="clear: both;"></div>
		</div>
	{% endif %}
	
	{% for compo, placings in competitions %}
		<div class="competition">
			<a id="competition_{{ compo.id }}"></a>
			<h3>
				{{ compo.name }}
				<a href="{% url party_edit_competition party.id compo.id %}">
					<img src="/static/images/icons/edit.png" width="16" height="16" alt="Edit competition" title="Edit competition" />
				</a>
			</h3>
			{% if placings %}
				<table>
					{% for result, production, authors, affiliations in placings %}
						<tr>
							<td>{{ result.ranking }}</td>
							<td><a href="{{ production.get_absolute_url }}">{{ production.title }}</a></td>
							<td>{% if production.unparsed_byline %}{{ production.unparsed_byline }}{% else %}{% component_byline authors affiliations %}{% endif %}</td>
							<td>{{ result.score }}</td>
						</tr>
					{% endfor %}
				</table>
			{% endif %}
		</div>
	{% endfor %}
	
	<ul class="actions">
		<li>
			<a class="add open_in_lightbox" href="{% url party_add_competition party.id %}">Add competition</a>
		</li>
	</ul>
{% endblock %}
